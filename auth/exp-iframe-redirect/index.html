<!DOCTYPE html>
<head>
  <title>Sign into HITS</title>
</head>
<body>
  <button onclick="login">Sign in</button>

  <script src="https://alcdn.msauth.net/browser/2.20.0/js/msal-browser.min.js"></script>
  <script>
    const msalConfig = {
      auth: {
        clientId: "325dce49-3946-473a-9427-cd186fa462c2",
        authority: `https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/`,
        redirectUri: location.href,
      },
      system: {
        allowRedirectInIframe: true,
      },
    };

    const myMSALObj = new window.msal.PublicClientApplication(msalConfig);

    myMSALObj
      .handleRedirectPromise()
      .then(handleResponse)
      .catch((err) => {
        console.error(err);
      });

    function handleResponse(resp) {
      if (resp !== null) {
        accountId = resp.account.homeAccountId;
        myMSALObj.setActiveAccount(resp.account);
        console.log(resp.account);
      } else {
        // need to call getAccount here?
        const currentAccounts = myMSALObj.getAllAccounts();
        if (!currentAccounts || currentAccounts.length < 1) {
          return;
        } else if (currentAccounts.length > 1) {
          // Add choose account code here
        } else if (currentAccounts.length === 1) {
          const activeAccount = currentAccounts[0];
          myMSALObj.setActiveAccount(activeAccount);
          accountId = activeAccount.homeAccountId;
          console.log(activeAccount);
        }
      }
    }

    function login() {
      myMSALObj.loginRedirect({});
    }

    document.querySelector("button").onclick = () => login();
  </script>
</body>
